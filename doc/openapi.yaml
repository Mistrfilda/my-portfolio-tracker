openapi: 3.0.0

info:
    title: My Portfolio Tracker API
    version: 1.0.0

security:
    - ApiKey: []

paths:
    /ping:
        get:
            summary: Ping the API
            security:
                - ApiKey: []
            responses:
                '200':
                    description: OK
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    status:
                                        type: string
                                        example: ok
    /stocks:
        get:
            summary: Get list of all stock assets
            security:
                - ApiKey: []
            responses:
                '200':
                    description: List of stock assets
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/StockAsset'
    /home/device/record:
        post:
            summary: Create a new home device record
            security:
                - ApiKey: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/HomeDeviceRecordCreate'
            responses:
                '200':
                    description: Created home device record
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/HomeDeviceRecord'
    /home/device/records:
        get:
            summary: Get all devices with their latest measurements
            security:
                - ApiKey: []
            parameters:
                - name: limit
                  in: query
                  required: false
                  description: Number of records to return per device (default 10)
                  schema:
                      type: integer
                      default: 10
            responses:
                '200':
                    description: List of devices with their measurements
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/HomeDeviceWithRecords'

components:
    securitySchemes:
        ApiKey:
            type: apiKey
            in: header
            name: X-Api-Key
    schemas:
        StockAsset:
            type: object
            additionalProperties: false
            required:
                - id
                - name
                - ticker
                - exchange
                - currency
                - price
                - priceDownloadedAt
                - assetPriceDownloader
            properties:
                id:
                    type: string
                    format: uuid
                name:
                    type: string
                ticker:
                    type: string
                isin:
                    type: string
                    nullable: true
                exchange:
                    type: string
                currency:
                    type: string
                price:
                    type: number
                    format: float
                priceDownloadedAt:
                    type: string
                    format: date-time
                assetPriceDownloader:
                    type: string
        HomeDeviceRecordCreate:
            type: object
            additionalProperties: false
            required:
                - internalId
            properties:
                internalId:
                    type: string
                value:
                    oneOf:
                        - type: number
                          format: float
                        - type: boolean
                        - type: string
                    nullable: true
                unit:
                    type: string
                    nullable: true
                    enum:
                        - celsius
        HomeDeviceRecord:
            type: object
            additionalProperties: false
            required:
                - id
                - deviceInternalId
                - createdAt
            properties:
                id:
                    type: string
                    format: uuid
                deviceInternalId:
                    type: string
                value:
                    oneOf:
                        - type: number
                          format: float
                        - type: boolean
                        - type: string
                    nullable: true
                unit:
                    type: string
                    nullable: true
                createdAt:
                    type: string
                    format: date-time
        HomeDeviceRecordSimple:
            type: object
            additionalProperties: false
            required:
                - id
                - createdAt
            properties:
                id:
                    type: string
                    format: uuid
                value:
                    oneOf:
                        - type: number
                          format: float
                        - type: boolean
                        - type: string
                    nullable: true
                unit:
                    type: string
                    nullable: true
                createdAt:
                    type: string
                    format: date-time
        HomeDeviceWithRecords:
            type: object
            additionalProperties: false
            required:
                - id
                - internalId
                - name
                - type
                - records
            properties:
                id:
                    type: string
                    format: uuid
                internalId:
                    type: string
                name:
                    type: string
                type:
                    type: string
                latestRecord:
                    oneOf:
                        - $ref: '#/components/schemas/HomeDeviceRecordSimple'
                        - type: 'null'
                records:
                    type: array
                    items:
                        $ref: '#/components/schemas/HomeDeviceRecordSimple'


servers:
    - url: /api/v1
    - url: http://localhost/my-portfolio-tracker/www/api/v1
